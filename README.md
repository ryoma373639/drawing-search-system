# 📐 図面検索システム

図面ファイル（DWG、DXF、PDF、画像）を管理・検索できるElectronデスクトップアプリケーションです。

## 🌟 主な機能

### 1. **画像OCR機能**
- Tesseract.js (日本語+英語) でブラウザ内OCR処理
- 画像ファイルから自動的にテキスト抽出
- 抽出したテキストで検索可能

### 2. **ファイルプレビュー機能**
- PDFをブラウザ内で表示
- 画像ファイルをブラウザ内で表示

### 3. **個別ファイル削除機能**
- 検索結果から個別に削除可能
- 確認ダイアログ付き

### 4. **ソート/フィルタリング機能**
- 登録日時、ファイル名、ファイルサイズ、図版番号でソート
- 昇順/降順の切り替え
- ファイル形式でフィルター
- タグでフィルター

### 5. **CSVエクスポート機能**
- 現在の検索結果をCSVでエクスポート
- UTF-8 BOM付きでExcel互換

### 6. **メタデータ編集機能**
- 図版番号、品名、部品名、施主名を編集可能

### 7. **タグ機能**
- 図面にタグを追加/削除
- タグでフィルタリング

### 8. **全文検索 (FTS5)**
- SQLite FTS5による高速全文検索
- OCRテキストも検索対象
- PDFのテキストも検索対象
- 関連度順にソート

## 📦 Dropbox共有フォルダでの使い方

このアプリは**Dropbox共有フォルダに配置して、複数人で使用できます**。

### ✅ セットアップ手順

1. **アプリを配置**
   ```
   Dropbox/
   └── 図面検索システム/
       ├── 図面検索システム.app (Mac) または .exe (Windows)
       └── data/                    ← 自動作成される
           ├── drawings.db          ← データベース
           └── files/               ← アップロードファイル
   ```

2. **初回起動**
   - どなたか1人がアプリを起動すると、`data`フォルダが自動作成されます
   - データベースとファイルはすべて`data`フォルダに保存されます

3. **共有完了**
   - Dropbox同期後、全員が同じデータを閲覧・検索できます
   - 新しいファイルを追加すると、Dropbox経由で全員に共有されます

### ⚠️ 重要な注意事項

#### 🚨 同時アクセスについて

**複数人が同時にアプリを起動することは可能ですが、以下の制限があります:**

1. **閲覧・検索**: ✅ 複数人が同時に行っても問題ありません
2. **ファイルの追加・編集・削除**:
   - ⚠️ **同時に行うとデータベースエラーが発生する可能性があります**
   - 📝 **推奨**: ファイルの追加・編集・削除は1人ずつ行う
   - 💡 **ベストプラクティス**:
     - 「今からファイルを追加します」とSlackなどでアナウンス
     - 作業が終わったら「追加完了しました」とアナウンス
     - 他の人は閲覧・検索のみ行う

#### 🔄 Dropbox同期のタイミング

- ファイルを追加した直後は、Dropboxの同期が完了するまで他のメンバーには表示されません
- 同期アイコンを確認して、同期完了を待ってから他のメンバーに通知してください
- 同期完了後、他のメンバーは**アプリを再起動**すると最新データが表示されます

#### 💾 バックアップ推奨

- 重要なデータは定期的にバックアップしてください
- `data`フォルダ全体をコピーすればバックアップできます

## 📄 対応ファイル形式

- **CAD図面**: .dwg, .dxf
- **PDF**: .pdf
- **画像**: .jpg, .jpeg, .png, .tiff, .tif

## 🛠️ システム要件

- **OS**: macOS / Windows 10 / 11
- **メモリ**: 4GB以上推奨
- **ストレージ**: 500MB以上の空き容量
- **Dropbox** (オプション): 共有する場合のみ必要

## 🚀 使い方

### 基本的な流れ

1. **アプリを起動**
2. **ファイルをアップロード**
   - 「ファイルを追加」ボタンをクリック
   - または、ドラッグ&ドロップ
3. **メタデータを編集**（オプション）
   - 図版番号、品名、部品名、施主名を入力
   - タグを追加
4. **検索**
   - 検索ボックスにキーワードを入力
   - ファイル形式やタグでフィルター

### 検索のコツ

- **部分一致**: 「配管」と入力すると「配管図」「配管設備」などがヒット
- **複数キーワード**: スペース区切りで複数検索可能
- **OCRテキスト**: 画像内の文字も検索対象
- **PDFテキスト**: PDF内の文字も検索対象

## 🛠️ 開発者向け情報

### ソースからビルド

### 事前準備

```bash
npm install
```

### 開発モードで起動

```bash
npm start
```

### パッケージング

```bash
# macOS用
npm run build:mac

# Windows用
npm run build:win
```

### 技術スタック

- **フロントエンド**: HTML, CSS, JavaScript
- **バックエンド**: Electron, Express.js, Node.js
- **データベース**: SQLite (better-sqlite3) + FTS5全文検索
- **OCR**: Tesseract.js
- **PDF解析**: pdf-parse
- **ファイルアップロード**: Multer

## 📝 データの保存場所

- **データベース**: `[アプリのフォルダ]/data/drawings.db`
- **アップロードファイル**: `[アプリのフォルダ]/data/files/`

Dropbox共有フォルダにアプリを置いた場合、`data`フォルダも自動的にDropboxに同期されます。

## 🔒 セキュリティ

- **完全ローカル処理**: 図面データは一切外部に送信されません
- **外部API不使用**: OCR・検索は全てローカルで実行
- **オフライン対応**: インターネット接続不要で動作

## 📄 ライセンス

MIT License

## 🤝 貢献

プルリクエストを歓迎します！

GitHub: https://github.com/ryoma373639/drawing-search-system

---

🤖 Generated with [Claude Code](https://claude.com/claude-code)
